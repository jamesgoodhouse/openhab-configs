rule "Sunset Rule"
when
  Channel "astro:sun:home:set#event" triggered START
then
  var int dimLevel = 5
  var int dimLevelStep = 1
  var int maxDimLevel = 15
  var int timeoutNanos = 10000000
  var Timer timer = null

  if (timer === null) {
    timer = createTimer(now.plusSeconds(0), [ |
      Plug_Dimmer_Landing_Dimmer.sendCommand(dimLevel)
      if (dimLevel == maxDimLevel) {
        timer = null // cancel timer
      } else {
        dimLevel = dimLevel + dimLevelStep
        timer.reschedule(now.plusNanos(timeoutNanos))
      }
    ])
  }
end

rule "Midnight"
when
  Time is midnight
then
  Plug_Dimmer_Landing_Dimmer.sendCommand(0)
end
